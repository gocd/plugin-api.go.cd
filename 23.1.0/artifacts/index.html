<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name ="description" content="Extend GoCD's functionality. Implement GoCD plugins for SCMs, tasks, notifications, authentication, package repositories, elastic agents and authorization." />
    <meta name ="keywords" content="gocd plugins, plugins for gocd, extension points, open source gocd, open source continuous delivery" />
    <link href="../images/gocd.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="../images/gocd.png" rel="apple-touch-icon" type="image/png" size="192x192" />
    <title>GoCD Artifact Store Plugin API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sa {
  color: #ae81ff;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />

      <script src="../javascripts/all.js"></script>


      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>
  </head>

  <body class="artifacts artifacts_index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="" />
        <div class="lang-selector">
        </div>
      <div class="version-switcher">
        <span class="version-label">Switch version:</span>
        <select class="version"></select>
      </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/gocd/plugin-api.go.cd'>Edit this guide on GitHub</a></li>
            <li><a href='https://api.gocd.org'>GoCD API Documentation</a></li>
            <li><a href='https://docs.gocd.org'>GoCD User Documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="artifact-plugins">Artifact Plugins</h1>

<h2 id="extension-information">Extension Information</h2>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><strong>Availability</strong></td>
<td>GoCD version 18.11.0 onwards</td>
</tr>
<tr>
<td><strong>Extension Name</strong></td>
<td><code class="prettyprint">artifact</code></td>
</tr>
<tr>
<td><strong>Extension API Version</strong></td>
<td><code class="prettyprint">2.0</code></td>
</tr>
</tbody></table>

<h2 id="background">Background</h2>

<p>By default, GoCD internally manages and stores artifacts. The Artifact extension allows GoCD to make use of an external artifact store for storing artifacts while retaining traceability between pipelines. For example, by using the <a href="https://github.com/gocd/docker-registry-artifact-plugin">Docker artifact registry</a> plugin, a user can publish an image to a docker registry, and subsequently fetch it in a downstream pipeline. Since GoCD is &ldquo;aware&rdquo; of the artifact store with this extension, it can still maintain the Value Stream between the upstream and downstream pipelines even if the artifact is stored outside of GoCD.</p>

<p>Developers can start building their own artifact plugins by forking the
<a href="https://github.com/gocd/docker-registry-artifact-plugin">docker plugin</a> as an example reference implementation.</p>

<h2 id="how-will-it-help-you">How will it help you?</h2>

<p>A feature like this will allow for artifacts to be uploaded and stored outside of GoCD. Previously, the artifacts were only managed on the GoCD server.</p>

<h1 id="requests-from-the-gocd-server">Requests from the GoCD server</h1>

<p>In order to implement an artifact extension point the following messages must be implemented by the plugin.</p>

<ul>
<li><a href="#publish-artifact">Publish Artifact</a></li>
<li><a href="#fetch-artifact">Fetch Artifact</a></li>
<li><a href="#get-plugin-capabilities">Capabilities</a></li>
</ul>

<p>These are general purpose messages that a plugin must implement to allow users to configure the plugin through the browser.</p>

<ul>
<li><a href="#get-plugin-icon">Get Plugin Icon</a></li>
</ul>

<p>These are messages that a plugin must implement in order to allow users to configure artifact stores through the browser.</p>

<ul>
<li><a href="#get-store-config-metadata">Get Store Config Metadata</a></li>
<li><a href="#get-store-config-view">Get Store Config View</a></li>
<li><a href="#validate-store-config">Validate Store Config</a></li>
</ul>

<p>These are messages that a plugin must implement in order to allow users to configure publishing an artifact through the browser.</p>

<ul>
<li><a href="#get-publish-artifact-metadata">Get Publish Artifact Metadata</a></li>
<li><a href="#get-publish-artifact-view">Get Publish Artifact View</a></li>
<li><a href="#validate-publish-artifact-config">Validate Publish Artifact Configuration</a></li>
</ul>

<p>These are messages that a plugin must implement in order to allow users to configure fetching an artifact through the browser.</p>

<ul>
<li><a href="#get-fetch-artifact-metadata">Get Fetch Artifact Metadata</a></li>
<li><a href="#get-fetch-artifact-view">Get Fetch Artifact View</a></li>
<li><a href="#validate-fetch-artifact-config">Validate Fetch Artifact Configuration</a> </li>
</ul>

<h2 id="publish-artifact">Publish Artifact</h2>

<p>This message is a request to the plugin to publish an artifact to the specified artifact store.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.publish-artifact</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>Given the following config XML snippet â€”</p>
</blockquote>

<div class="highlight"><pre class="highlight xml"><code>
<span class="nt">&lt;artifactStores&gt;</span>
      <span class="nt">&lt;artifactStore</span> <span class="na">id=</span><span class="s">"dockerhub"</span> <span class="na">pluginId=</span><span class="s">"cd.go.artifact.docker.registry"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>RegistryURL<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>https://index.docker.io/v1/<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>Username<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>boohoo<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>Password<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>password<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;/artifactStore&gt;</span>
    <span class="nt">&lt;/artifactStores&gt;</span>
<span class="nt">&lt;pipelines</span> <span class="na">group=</span><span class="s">"first"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;pipeline</span> <span class="na">name=</span><span class="s">"build"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;job</span> <span class="na">name=</span><span class="s">"build-job"</span><span class="nt">&gt;</span>
      ...
      <span class="nt">&lt;artifacts&gt;</span>
        <span class="nt">&lt;artifact</span> <span class="na">id=</span><span class="s">"app-image"</span> <span class="na">storeId=</span><span class="s">"dockerhub"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;property&gt;</span>
              <span class="nt">&lt;key&gt;</span>Image<span class="nt">&lt;/key&gt;</span>
              <span class="nt">&lt;value&gt;</span>gocd/gocd-demo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property&gt;</span>
              <span class="nt">&lt;key&gt;</span>Tag<span class="nt">&lt;/key&gt;</span>
              <span class="nt">&lt;value&gt;</span>v${GO_PIPELINE_COUNTER}<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/artifact&gt;</span>
      <span class="nt">&lt;/artifacts&gt;</span>
    <span class="nt">&lt;/job&gt;</span>
    ...
  <span class="nt">&lt;/pipeline&gt;</span>
<span class="nt">&lt;/pipelines&gt;</span>
</code></pre></div>

<blockquote>
<p>The plugin will receive the following JSON body â€”</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"environment_variables"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"GO_PIPELINE_NAME"</span><span class="p">:</span><span class="s2">"build"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GO_TRIGGER_USER"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"FOO"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"artifact_plan"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"BuildFile"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Image"</span><span class="p">:</span><span class="s2">"gocd/gocd-demo"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Tag"</span><span class="p">:</span><span class="s2">"v${GO_PIPELINE_COUNTER}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"app-image"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"storeId"</span><span class="p">:</span><span class="s2">"dockerhub"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"artifact_store"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"RegistryURL"</span><span class="p">:</span><span class="s2">"https://index.docker.io/v1/"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Username"</span><span class="p">:</span><span class="s2">"boohoo"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Password"</span><span class="p">:</span><span class="s2">"password"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"dockerhub"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"agent_working_directory"</span><span class="p">:</span><span class="s2">"/Users/varshavs/gocd/agent/pipelines/build"</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The request body will contain the following JSON elements:</p>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">environment_variables</code></td>
<td><code class="prettyprint">Object</code></td>
<td>A map of the environment variable that were available at the time the job was triggered.</td>
</tr>
<tr>
<td><code class="prettyprint">artifact_plan</code></td>
<td><code class="prettyprint">Object</code></td>
<td>This mainly contains the configuration properties that inform the plugin about the specific artifact that needs to be pushed.</td>
</tr>
<tr>
<td><code class="prettyprint">artifact_store</code></td>
<td><code class="prettyprint">Object</code></td>
<td>This section contains the details about the artifact store to which the plugin has to publish the artifact.</td>
</tr>
<tr>
<td><code class="prettyprint">agent_working_directory</code></td>
<td><code class="prettyprint">String</code></td>
<td>Since the artifact publishing happens on the go-agent side, the working directory is also passed along in the request in case the plugin wants to use it.</td>
</tr>
</tbody></table>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to return a json as shown. This json is written into a file called <code class="prettyprint">&lt;plugin-id&gt;.json</code> on the agent and uploaded as a <code class="prettyprint">Build Artifact</code> to the GoCD server to a directory called <code class="prettyprint">pluggable-artifact-metadata</code>. This directory is never removed as part of cleaning GoCD artifacts.</p>

<blockquote>
<p>Plugin response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"metadata"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"gocd/gocd-demo:v23"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"digest"</span><span class="p">:</span><span class="s2">"sha256:f7840887b6f09f531935329a4ad1f6176866675873a8b3eed6a5894573da8247"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>The content of plugin-id.json file</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"app-image"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"gocd/gocd-demo:v23"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"digest"</span><span class="p">:</span><span class="s2">"sha256:f7840887b6f09f531935329a4ad1f6176866675873a8b3eed6a5894573da8247"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p><em>Note: <code class="prettyprint">app-image</code> is the artifact id specified in the job configuration</em></p>
</blockquote>

<h2 id="fetch-artifact">Fetch Artifact</h2>

<p>This message is a request to the plugin to fetch an artifact from the specified artifact store.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.fetch-artifact</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>Given the following config XML snippet â€”</p>
</blockquote>

<div class="highlight"><pre class="highlight xml"><code>
<span class="nt">&lt;artifactStores&gt;</span>
      <span class="nt">&lt;artifactStore</span> <span class="na">id=</span><span class="s">"dockerhub"</span> <span class="na">pluginId=</span><span class="s">"cd.go.artifact.docker.registry"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>RegistryURL<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>https://index.docker.io/v1/<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>Username<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>boohoo<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property&gt;</span>
          <span class="nt">&lt;key&gt;</span>Password<span class="nt">&lt;/key&gt;</span>
          <span class="nt">&lt;value&gt;</span>password<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;/artifactStore&gt;</span>
    <span class="nt">&lt;/artifactStores&gt;</span>
<span class="nt">&lt;pipelines</span> <span class="na">group=</span><span class="s">"first"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;pipeline</span> <span class="na">name=</span><span class="s">"build"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;job</span> <span class="na">name=</span><span class="s">"build-job"</span><span class="nt">&gt;</span>
      ...
      <span class="nt">&lt;artifacts&gt;</span>
        <span class="nt">&lt;artifact</span> <span class="na">type=</span><span class="s">"external"</span> <span class="na">id=</span><span class="s">"app-image"</span> <span class="na">storeId=</span><span class="s">"dockerhub"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;property&gt;</span>
              <span class="nt">&lt;key&gt;</span>Image<span class="nt">&lt;/key&gt;</span>
              <span class="nt">&lt;value&gt;</span>gocd/gocd-demo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property&gt;</span>
              <span class="nt">&lt;key&gt;</span>Tag<span class="nt">&lt;/key&gt;</span>
              <span class="nt">&lt;value&gt;</span>v${GO_PIPELINE_COUNTER}<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/artifact&gt;</span>
      <span class="nt">&lt;/artifacts&gt;</span>
    <span class="nt">&lt;/job&gt;</span>
    ...

    <span class="nt">&lt;stage</span> <span class="na">name=</span><span class="s">"downstream_stage"</span><span class="nt">&gt;</span>
      ...
      <span class="nt">&lt;job</span> <span class="na">name=</span><span class="s">"downstream_job"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tasks&gt;</span>
            <span class="nt">&lt;fetchartifact</span> <span class="na">artifactOrigin=</span><span class="s">"external"</span> <span class="na">stage=</span><span class="s">"upstream_stage"</span> <span class="na">job=</span><span class="s">"build-job"</span> <span class="na">artifactId=</span><span class="s">"app-image"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;property&gt;</span>
                  <span class="nt">&lt;key&gt;</span>image_name<span class="nt">&lt;/key&gt;</span>
                  <span class="nt">&lt;value&gt;</span>release-candidate<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/property&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/fetchartifact&gt;</span>
        <span class="nt">&lt;/tasks&gt;</span>
      <span class="nt">&lt;/job&gt;</span>
      ...
    <span class="nt">&lt;/stage&gt;</span>
  <span class="nt">&lt;/pipeline&gt;</span>
<span class="nt">&lt;/pipelines&gt;</span>
</code></pre></div>

<blockquote>
<p>The plugin will receive the following JSON body â€”</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"fetch_artifact_configuration"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"image_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"release-candidate"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"artifact_metadata"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"gocd/gocd-demo:v23"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"digest"</span><span class="p">:</span><span class="s2">"sha256:f7840887b6f09f531935329a4ad1f6176866675873a8b3eed6a5894573da8247"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"store_configuration"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"RegistryURL"</span><span class="p">:</span><span class="s2">"https://index.docker.io/v1/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Username"</span><span class="p">:</span><span class="s2">"boohoo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Password"</span><span class="p">:</span><span class="s2">"password"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"agent_working_directory"</span><span class="p">:</span><span class="s2">"/Users/varshavs/gocd/agent/pipelines/build"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The request body will contain the following JSON elements:</p>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">fetch_artifact_configuration</code></td>
<td><code class="prettyprint">Object</code></td>
<td>This mainly contains the configuration properties that inform the plugin about the specific artifact that needs to be fetched.</td>
</tr>
<tr>
<td><code class="prettyprint">artifact_metadata</code></td>
<td><code class="prettyprint">Object</code></td>
<td>This is the information that was uploaded as a json file to the GoCD server at publish time. The json file is parsed and its contents are passed to the plugin at fetch time so that the plugin can fetch the right artifact.</td>
</tr>
<tr>
<td><code class="prettyprint">store_configuration</code></td>
<td><code class="prettyprint">Object</code></td>
<td>This section contains the details about the artifact store from which the plugin has to fetch the artifact.</td>
</tr>
<tr>
<td><code class="prettyprint">agent_working_directory</code></td>
<td><code class="prettyprint">String</code></td>
<td>Since the artifact download happens on the go-agent side, the working directory is also passed along in the request in case the plugin wants to use it.</td>
</tr>
</tbody></table>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin can respond with a list of environment variables which will be set on the job, for all further tasks in that job to use. It can also return an empty list (<code class="prettyprint">[]</code>). Existing environment variables will be overridden, if they are returned as a part of this response.</p>

<blockquote>
<p>Example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IMAGE_ID"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"image1/v23"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MY_SECRET_ENV_VAR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some-password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>The response body will contain the following JSON elements:</p>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">name</code></td>
<td><code class="prettyprint">String</code></td>
<td>The key or name of the environment variable to set.</td>
</tr>
<tr>
<td><code class="prettyprint">value</code></td>
<td><code class="prettyprint">String</code></td>
<td>The value of the environment variable to set.</td>
</tr>
<tr>
<td><code class="prettyprint">secure</code></td>
<td><code class="prettyprint">Boolean</code></td>
<td>Should it be a secure environment variable or not?</td>
</tr>
</tbody></table>

<h2 id="get-plugin-capabilities">Get Plugin Capabilities</h2>

<p>This message is a request to the plugin to provide plugin capabilities. Currently the plugin does not support any capabilities, so plugins should return an empty JSON as a response. In the future, based on these capabilities GoCD would enable or disable the plugin features for a user.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.get-capabilities</code></p>

<p class='request-body-heading'>Request body</p>

<p>Server sends request an <code class="prettyprint">Empty</code> request body.</p>

<p class='response-code-heading'>Response Body</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request, with an empty response body</p>

<h2 id="get-plugin-icon">Get Plugin Icon</h2>

<p>This call is expected to return the icon for the plugin, so as to make it easy for users to identify the plugin.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.get-icon</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example plugin response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"content_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"image/svg+xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PHN2ZyB2ZXJzaW9u..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin is expected to return an <a href="#the-image-object">image object</a>.</p>

<aside class="notice">
  <strong>It is recommended that:</strong>
  <ul>
    <li>The image be an SVG image, since it scales well. Using other types like PNG/JPEG/GIF/BMP will work too, but is not recommended.</li>
    <li>The image be a square image.</li>
    <li>The base-64 encoded data is &lt;= 100KB. Bigger sizes will work too, but may take a long time to render.</li>
  </ul>
</aside>

<h2 id="get-store-config-metadata">Get Store Config Metadata</h2>

<p>This is a message that the plugin should implement, to allow users to configure global artifact stores from the Artifact Stores View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.store.get-metadata</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body for a docker plugin</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RegistryURL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>A JSON <a href="#the-metadata-object">metadata object</a>.</p>

<h2 id="get-store-config-view">Get Store Config View</h2>

<p>This is a message that the plugin should implement, to allow users to configure artifact stores from the Artifact Stores View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.store.get-view</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-get-settings-view-object">settings view object</a></p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;some html&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="validate-store-config">Validate Store Config</h2>

<p>This call is expected to validate the user inputs that form a part of the artifact store.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.store.validate</code></p>

<p class='request-body-heading'>Request body</p>

<p>The request body will contain a JSON object with the keys and values that form part of the profile.</p>

<blockquote>
<p>An example validation request body</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"RegistryURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://index.docker.io/v1/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boohoo"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>The plugin should respond with JSON array response for each configuration key that has a validation error</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RegistryURL"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"'RegistryURL is invalid'"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>If any of the input keys have a validation error on them, the plugin is expected to return a list of <a href="#the-validation-error-object">validation error objects</a>. If the profile is valid, the plugin should return an empty JSON array.</p>

<h2 id="get-publish-artifact-metadata">Get Publish Artifact Metadata</h2>

<p>This is a message that the plugin should implement, to allow users to configure external artifacts from the Job Config View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.publish.get-metadata</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tag"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>A JSON <a href="#the-metadata-object">metadata object</a>.</p>

<h2 id="get-publish-artifact-view">Get Publish Artifact View</h2>

<p>This is a message that the plugin should implement, to allow users to configure external artifacts from the Job Config View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.publish.get-view</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-get-settings-view-object">settings view object</a></p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;some html&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="validate-publish-artifact-config">Validate Publish Artifact Config</h2>

<p>This call is expected to validate the user inputs that form a part of the publish external artifact config.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.publish.validate</code></p>

<p class='request-body-heading'>Request body</p>

<p>The request body will contain a JSON object with the keys and values that form part of the profile.</p>

<blockquote>
<p>An example validation request body</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gocd/gocd-demo"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Tag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boohoo"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"BuildFile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo.json"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>The plugin should respond with JSON array response for each configuration key that has a validation error</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Either `BuildFile` or `Image` must be specified"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BuildFile"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Either `BuildFile` or `Image` must be specified"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>If any of the input keys have a validation error on them, the plugin is expected to return a list of <a href="#the-validation-error-object">validation error objects</a>. If the profile is valid, the plugin should return an empty JSON array.</p>

<aside class='notice'>
  There are some cases wherein the GoCD server cannot make the request to validate the plugin configuration when configured from the UI. This usually happens when the plugin id cannot be determined from the publish or fetch config.
  The request to validate the plugin properties happens only from the UI and the API. It does not happen when the cruise-config.xml is directly edited.
  Given the above cases, is recommended to perform the plugin validation right before the publish or fetch operation as well.
</aside>

<h2 id="get-fetch-artifact-metadata">Get Fetch Artifact Metadata</h2>

<p>This is a message that the plugin should implement, to allow users to configure fetch artifact task from the Task View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.fetch.get-metadata</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DestOnAgent"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>A JSON <a href="#the-metadata-object">metadata object</a>.</p>

<h2 id="get-fetch-artifact-view">Get Fetch Artifact View</h2>

<p>This is a message that the plugin should implement, to allow users to configure fetch artifact task from the Task View in GoCD.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.fetch.get-view</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-get-settings-view-object">settings view object</a></p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;some html&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="validate-fetch-artifact-config">Validate Fetch Artifact Config</h2>

<p>This call is expected to validate the user inputs that form a part of the fetch external artifact config.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">cd.go.artifact.publish.validate</code></p>

<p class='request-body-heading'>Request body</p>

<p>The request body will contain a JSON object with the keys and values that form part of the profile.</p>

<blockquote>
<p>An example validation request body</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Dest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>The plugin should respond with JSON array response for each configuration key that has a validation error</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dest"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>If any of the input keys have a validation error on them, the plugin is expected to return a list of <a href="#the-validation-error-object">validation error objects</a>. If the profile is valid, the plugin should return an empty JSON array.</p>

<aside class='notice'>
  There are some cases wherein the GoCD server cannot make the request to validate the plugin configuration when configured from the UI. This usually happens when the plugin id cannot be determined from the publish or fetch config.
  The request to validate the plugin properties happens only from the UI and the API. It does not happen when the cruise-config.xml is directly edited.
  Given the above cases, is recommended to perform the plugin validation right before the publish or fetch operation as well.
</aside>

<h1 id="requests-to-the-gocd-server">Requests to the GoCD server</h1>

<p>The plugin may make the following requests to the server using <code class="prettyprint">GoApplicationAccessor#submit(GoApiRequest)</code></p>

<ul>
<li><a href="#send-console-log">Send Console Log</a></li>
</ul>

<h2 id="send-console-log">Send Console Log</h2>

<p>The plugin can send console logs to the server while fetching or publishing artifacts.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.processor.artifact.console-log</code></p>

<p class='request-body-heading'>Request version</p>

<p>The request version must be set to <code class="prettyprint">1.0</code>.</p>

<p class='request-name-heading'>Request body</p>

<p>The request body must contain the logLevel and a message string. The logLevel must be <code class="prettyprint">INFO</code> or <code class="prettyprint">ERROR</code>.</p>

<blockquote>
<p>Example Request Body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"logLevel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INFO"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an info message."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='request-name-heading'>Response code</p>

<p>The server is expected to return status <code class="prettyprint">200</code> if it could process the request.</p>

<p class='request-name-heading'>Response body</p>

<p>The server will not send a response body.</p>

<blockquote>
<p>Console Logger Example</p>
</blockquote>

<div class="highlight"><pre class="highlight java"><code><span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.GoApplicationAccessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.GoPluginIdentifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.request.DefaultGoApiRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.DefaultGoApiResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.GoApiResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogger</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">SEND_CONSOLE_LOG</span> <span class="o">=</span> <span class="s">"go.processor.artifact.console-log"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">API_VERSION</span> <span class="o">=</span> <span class="s">"1.0"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">GoPluginIdentifier</span> <span class="no">PLUGIN_IDENTIFIER</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GoPluginIdentifier</span><span class="o">(</span><span class="s">"artifact"</span><span class="o">,</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="no">API_VERSION</span><span class="o">));</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">getLoggerFor</span><span class="o">(</span><span class="nc">DockerRegistryArtifactPlugin</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ConsoleLogger</span> <span class="n">consoleLogger</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">ConsoleLogger</span><span class="o">(</span><span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">accessor</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sendLog</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConsoleLogMessage</span><span class="o">(</span><span class="nc">ConsoleLogMessage</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="n">message</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sendLog</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConsoleLogMessage</span><span class="o">(</span><span class="nc">ConsoleLogMessage</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="n">message</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendLog</span><span class="o">(</span><span class="nc">ConsoleLogMessage</span> <span class="n">consoleLogMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">DefaultGoApiRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultGoApiRequest</span><span class="o">(</span><span class="no">SEND_CONSOLE_LOG</span><span class="o">,</span> <span class="no">API_VERSION</span><span class="o">,</span> <span class="no">PLUGIN_IDENTIFIER</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setRequestBody</span><span class="o">(</span><span class="n">consoleLogMessage</span><span class="o">.</span><span class="na">toJSON</span><span class="o">());</span>

        <span class="nc">GoApiResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">DefaultGoApiResponse</span><span class="o">.</span><span class="na">SUCCESS_RESPONSE_CODE</span><span class="o">)</span> <span class="o">{</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Failed to submit console log: %s"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">()));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ConsoleLogger</span> <span class="nf">getLogger</span><span class="o">(</span><span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">consoleLogger</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">ConsoleLogger</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">consoleLogger</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">consoleLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConsoleLogger</span><span class="o">(</span><span class="n">accessor</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">consoleLogger</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ConsoleLogMessage</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">LogLevel</span> <span class="n">logLevel</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ConsoleLogMessage</span><span class="o">(</span><span class="nc">LogLevel</span> <span class="n">logLevel</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">logLevel</span> <span class="o">=</span> <span class="n">logLevel</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toJSON</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Gson</span><span class="o">().</span><span class="na">toJson</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">enum</span> <span class="nc">LogLevel</span> <span class="o">{</span>
            <span class="no">INFO</span><span class="o">,</span> <span class="no">ERROR</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h1 id="request-response-json-objects">Request/Response JSON Objects</h1>

<p><a id='the-get-settings-view-object'></a></p>

<h3 id="the-settings-view-object">The Settings View Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the settings view object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div class=</span><span class="se">\"</span><span class="s2">form_item_block</span><span class="se">\"</span><span class="s2">&gt;...&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">template</code></td>
<td>String</td>
<td>A string containing an HTML AngularJS based view.</td>
</tr>
</tbody></table>

<p>This template is an <a href="https://angularjs.org">AngularJS</a> based template.</p>

<p>GoCD uses Angular JS as its template engine for the plugin UI. This allows plugin authors to use a limited set of AngularJS features to specify how the UI of their plugins looks.</p>

<aside class='notice'>
  <strong>Note:</strong> Some plugin endpoints, like the Package Repository plugin, do not use this for their view.
</aside>

<div style='clear: both;'></div>

<h4 id="getting-started-with-angularjs-based-templates">Getting started with AngularJS based templates</h4>

<blockquote>
<p>Given a configuration:</p>
</blockquote>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;key&gt;</span>username<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;value&gt;</span>alice<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>

<blockquote>
<p>This gets converted into the following JSON representation in the browser:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>The AngularJS template is expected to bind to the JSON object shown above:</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>When an Angular template is used in a Go plugin, to define the configuration UI, the configuration key which is stored in the configuration XML is used everywhere and is expected to be consistent. Since Angular works off of JSON, GoCD will make sure that the key in the JSON provided to the Angular template is the same as the key in the configuration XML.</p>

<p>Suppose the key of the configuration property stored in the XML is &ldquo;username&rdquo;, with value, &ldquo;alice&rdquo;, then Go will make sure that the value is available to the template as &ldquo;username&rdquo; when used in an Angular-specific HTML attribute like &ldquo;ng-model&rdquo;.</p>

<p><img src="../images/plugin_angular.png" alt="Plugin Angular Architecture" /></p>

<p>So, the name &ldquo;foobar&rdquo; needs to be the same across the configuration XML, the Angular template as well as in any code that the plugin has.</p>

<div style='clear: both;'></div>

<h4 id="showing-validation-errors-in-the-ui">Showing validation errors in the UI</h4>

<blockquote>
<p>We use some simple string replacement<br/>
to substitute <code class="prettyprint">GOINPUTNAME</code> with a unique identifier<br/>
for your plugin in order to render<br/>
any server side errors</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"form_error"</span> <span class="na">ng-show=</span><span class="s">"GOINPUTNAME[username].$error.server"</span><span class="nt">&gt;</span>
    {{ GOINPUTNAME[username].$error.server}}
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>In case of validation errors returned by <code class="prettyprint">go.plugin-settings.validate-configuration</code>, the error messages needs to be populated on the UI, use the snippet here to show the validation errors.</p>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-plugin-settings-configuration-object">The Plugin Settings Configuration Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the plugin settings configuration object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server URL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">display-name</code></td>
<td>String</td>
<td>The name of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">default-value</code></td>
<td>String</td>
<td>The default value of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">display-order</code></td>
<td>String</td>
<td>A string containing a numerical value.</td>
</tr>
<tr>
<td><code class="prettyprint">required</code></td>
<td>Boolean</td>
<td>If the field is mandatory.</td>
</tr>
<tr>
<td><code class="prettyprint">secure</code></td>
<td>Boolean</td>
<td>If the data in the field should be stored encrypted.</td>
</tr>
</tbody></table>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-validation-error-object">The Validation Error Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the validation error object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email_address"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address is invalid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password must be provided"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">key</code></td>
<td>String</td>
<td>The name of configuration key that has an error.</td>
</tr>
<tr>
<td><code class="prettyprint">message</code></td>
<td>String</td>
<td>The error message associated with that key.</td>
</tr>
</tbody></table>

<p><a id='the-image-object'></a></p>

<h3 id="the-image-object">The Image Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the image object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"content_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"image/svg+xml"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"...."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content_type</code></td>
<td>String</td>
<td>A valid <a href="https://www.iana.org/assignments/media-types/media-types.xhtml#image">content type</a> for the image. Please make sure the content type is supported by most browsers.</td>
</tr>
<tr>
<td><code class="prettyprint">data</code></td>
<td>String</td>
<td>A <a href="https://en.wikipedia.org/wiki/Base64">base-64</a> encoded (single-line non-chunking) byte array of the byte-sequence that composes the image.</td>
</tr>
</tbody></table>

<p><a id='the-metadata-object'></a></p>

<h3 id="the-metadata-object">The Metadata Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the metadata object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">key</code></td>
<td>String</td>
<td>The name of the configuration property supported by an artifact store, publish artifact config and fetch artifact config.</td>
</tr>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>Object</td>
<td>The metadata associated with the key. Valid keys are <code class="prettyprint">required</code> and <code class="prettyprint">secure</code>.</td>
</tr>
</tbody></table>

<p><a id='the-server-info-object'></a></p>

<h3 id="the-server-info-object">The server info object</h3>

<blockquote>
<p>Here&rsquo;s an example of the server info object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"df0cb9be-2696-4689-8d46-1ef3c4e4447c"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com:8153/go"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"secure_site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com:8154/go"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">server_id</code></td>
<td>String</td>
<td>This contains a unique identifier for this server.</td>
</tr>
<tr>
<td><code class="prettyprint">site_url</code></td>
<td>String</td>
<td>This contains the site url configured for this server.</td>
</tr>
<tr>
<td><code class="prettyprint">secure_site_url</code></td>
<td>String</td>
<td>This contains the secure site url configured for this server.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48357651-2', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
