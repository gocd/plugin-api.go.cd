<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name ="description" content="Extend GoCD's functionality. Implement GoCD plugins for SCMs, tasks, notifications, authentication, package repositories, elastic agents and authorization." />
    <meta name ="keywords" content="gocd plugins, plugins for gocd, extension points, open source gocd, open source continuous delivery" />
    <link href="../images/gocd.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="../images/gocd.png" rel="apple-touch-icon" type="image/png" size="192x192" />
    <title>GoCD Notification Plugin API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sa {
  color: #ae81ff;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />

      <script src="../javascripts/all.js"></script>


      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>
  </head>

  <body class="notifications notifications_index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="" />
        <div class="lang-selector">
        </div>
      <div class="version-switcher">
        <span class="version-label">Switch version:</span>
        <select class="version"></select>
      </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/gocd/plugin-api.go.cd'>Edit this guide on GitHub</a></li>
            <li><a href='https://api.gocd.org'>GoCD API Documentation</a></li>
            <li><a href='https://docs.gocd.org'>GoCD User Documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="notification-plugins">Notification Plugins</h1>

<h2 id="extension-information">Extension Information</h2>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><strong>Availability</strong></td>
<td>GoCD version 18.9.0 onwards</td>
</tr>
<tr>
<td><strong>Extension Name</strong></td>
<td><code class="prettyprint">notification</code></td>
</tr>
<tr>
<td><strong>Extension API Version</strong></td>
<td><code class="prettyprint">4.0</code></td>
</tr>
</tbody></table>

<h2 id="current-version">Current Version</h2>

<p>This document is for version 4.0 (the latest) of the notification endpoint.</p>

<h2 id="introduction">Introduction</h2>

<p>Notification extension endpoint allows GoCD to send notifications about builds and agent state changes over various channels.</p>

<p>If you&rsquo;re looking to start away with a basic template for notification plugins, we recommend forking this <a href="https://github.com/gocd-contrib/notification-skeleton-plugin">github repository</a>.</p>

<h1 id="requests-from-the-gocd-server">Requests from the GoCD server</h1>

<p>In order to implement the notification extension point the following messages must be implemented by the plugin.</p>

<ul>
<li><a href="#notifications-interested-in">Notifications Interested In</a></li>
<li><a href="#stage-status-changed">Stage Status Changed</a></li>
<li><a href="#agent-status-changed">Agent Status Changed</a></li>
</ul>

<p>These are general purpose messages that a plugin may implement to allow users to configure the plugin through the browser.</p>

<ul>
<li><a href="#get-settings-view">Get Settings View</a></li>
<li><a href="#get-plugin-configuration">Get Plugin Configuration</a></li>
<li><a href="#validate-plugin-configuration">Validate Plugin Configuration</a></li>
</ul>

<h2 id="notifications-interested-in">Notifications Interested In</h2>

<p>This message is a request to the plugin to check what sort of notifications the plugin is interested to receive.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">notifications-interested-in</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to return a JSON object with the key <code class="prettyprint">notifications</code> that lists all notifications.</p>

<p>Currently supported notifications include:</p>

<ul>
<li><code class="prettyprint">stage-status</code>. See <a href="#stage-status-changed">stage status changed</a> for the information that the plugin receives on stage status change.</li>
</ul>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"stage-status"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="stage-status-changed">Stage Status Changed</h2>

<p>This message is sent by the server, when it wants to notify the plugin about a &ldquo;stage status change&rdquo;.</p>

<p>Stage status changed notifications only get sent when a stage gets scheduled or when it completes.</p>

<aside class="info">
  <strong>Note</strong>: As part of notification plugin endpoint V3, all timestamp&rsquo;s are in `UTC` with the DateTime format <strong>&ldquo;yyyy-MM-dd&rsquo;T'HH:mm:ss.SSSZ&rdquo;</strong>
</aside>

<p><a id='stage-start-body'></a></p>

<h3 id="request-response-basics">Request-Response basics</h3>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">stage-status</code></p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body if the plugin could send the notification successfully</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>An example response body if the plugin could not send the notification</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failure"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Could not send email for build/1/compile/1"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin is expected to return a JSON object to indicate if the notifications could be processed.</p>

<aside class="warning">
  <strong>Note</strong>: If plugin responds with error messages Go Server shows those in &ldquo;server health messages&rdquo;.
</aside>

<p><a id='stage-start-body'></a></p>

<h3 id="stage-start-notifications">Stage start notifications</h3>

<blockquote>
<p>A sample body when a stage with three jobs gets scheduled.</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"pipeline"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"defaultGroup"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build-cause"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"material"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"git-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"shallow-clone"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"branch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.x"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/organization/repository"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8f60b12439840e5a0a4d464379dd3a48881008b4"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"modified-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-23T17:27:58.000+0000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"stage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stage-2"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"approval-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"approved-by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timer"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"previous-stage-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stage-1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"previous-stage-counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Building"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"create-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-23T20:44:02.119+0000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"jobs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job1"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"schedule-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-23T20:44:02.119+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Scheduled"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job2"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"schedule-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-23T20:44:02.119+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Scheduled"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job3"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"schedule-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-03-23T20:44:02.119+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Scheduled"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>These notifications get sent out when a stage starts. The request body will contain a JSON representing the stage that is starting.</p>

<ul>
<li><p>A stage start notification can be identified by the <code class="prettyprint">.pipeline.stage.state</code> attribute set to <code class="prettyprint">Building</code>.</p></li>
<li><p>For a stage with multiple jobs, all jobs will be made available in the JSON document.</p></li>
<li><p>Each job state <code class="prettyprint">.pipeline.stage.jobs[].state</code> will be set to <code class="prettyprint">Scheduled</code>.</p></li>
<li><p>Since the jobs have not run yet, every <code class="prettyprint">.pipeline.stage.jobs[].result</code> will be set to <code class="prettyprint">Unknown</code>.</p></li>
<li><p>From version 4.0 of Notification Endpoint the stage status notification message includes details of <code class="prettyprint">previous-stage-name</code> and <code class="prettyprint">previous-stage-counter</code>
The subsequent stages in a pipeline are scheduled upon completion of the preceding stage or on manual trigger. The <code class="prettyprint">previous-stage-name</code> and <code class="prettyprint">previous-stage-counter</code> gives details of the preceding stage in the pipeline responsible for scheduling the current stage.</p></li>
</ul>

<aside class="note">
In the bullets above, all JSON paths use the jq syntax documented here: https://stedolan.github.io/jq/manual/v1.5/
</aside>

<p><a id='stage-complete-body'></a></p>

<h3 id="stage-completion-notifications">Stage completion notifications</h3>

<blockquote>
<p>A sample body when a stage with one job completes successfully.</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"pipeline"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-label"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-group"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build-cause"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"material"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"git-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"shallow-clone"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"branch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"branch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://user:******@gitrepo.com"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"modified-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-04-06T12:50:03.317+0000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"stage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stage-2"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"approval-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"approved-by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"changes"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"previous-stage-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stage-1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"previous-stage-counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"create-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:37.100+0000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"last-transition-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:39.100+0000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"jobs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job-name"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"schedule-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:37.100+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"assign-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:38.100+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"complete-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:39.100+0000"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Completed"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"agent-uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>These notifications get sent out after a stage completes. The request body will contain a JSON representing the stage that completed.</p>

<ul>
<li><p>Stage completion notifications can be identified when the <code class="prettyprint">.pipeline.stage.state</code> is something other than <code class="prettyprint">Building</code>. Valid values are <code class="prettyprint">Passed</code>, <code class="prettyprint">Failed</code> and <code class="prettyprint">Cancelled</code>.</p></li>
<li><p>For a stage with multiple jobs, all jobs will be made available in the JSON document.</p></li>
<li><p>Each job state <code class="prettyprint">.pipeline.stage.jobs[].state</code> will be set to <code class="prettyprint">Completed</code>.</p></li>
<li><p>Every <code class="prettyprint">.pipeline.stage.jobs[].result</code> will one of <code class="prettyprint">&#39;Passed&#39;</code>, <code class="prettyprint">&#39;Failed&#39;</code> or <code class="prettyprint">&#39;Cancelled&#39;</code>.</p></li>
</ul>

<aside class="note">
In the bullets above, all JSON paths use the jq syntax documented here: https://stedolan.github.io/jq/manual/v1.5/
</aside>

<h2 id="agent-status-changed">Agent Status Changed</h2>

<p>This message is sent by the server, when it wants to notify the plugin about any change in agent state.</p>

<p>Agent status changed notifications only get sent when the the state of the agent has changed.</p>

<aside class="info">
  <strong>Note</strong>: As part of notification plugin endpoint V3, all timestamp&rsquo;s are in `UTC` with the DateTime format <strong>&ldquo;yyyy-MM-dd&rsquo;T'HH:mm:ss.SSSZ&rdquo;</strong>
</aside>

<h3 id="request-response-basics">Request-Response basics</h3>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">agent-status</code></p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body if the plugin could send the notification successfully</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>An example response body if the plugin could not send the notification</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failure"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Could not send email for agent agent_hostname"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin is expected to return a JSON object to indicate if the notifications could be processed.</p>

<aside class="warning">
  <strong>Note</strong>: If plugin responds with error messages Go Server shows those in &ldquo;server health messages&rdquo;.
</aside>

<h3 id="agent-state-change-notifications">Agent state change notifications</h3>

<blockquote>
<p>A sample body when the agent state changes building.</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"agent_config_state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"agent_state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"building"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"building"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"is_elastic"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"host_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"agent_hostname"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ip_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"127.0.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"operating_system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rh"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transition_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-15T06:31:28.998+0000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"agent_uuid"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The agent status notifications is sent out when the state of an agent changes. The change of state can be either to <code class="prettyprint">agent_config_state</code>, <code class="prettyprint">build_state</code> or the <code class="prettyprint">agent_state</code>. The request body will contain a JSON representing the agent.</p>

<ul>
<li><code class="prettyprint">agent_config_state</code> - can be either <code class="prettyprint">Pending</code>, <code class="prettyprint">Enabled</code>, <code class="prettyprint">Disabled</code></li>
<li><code class="prettyprint">agent_state</code> - can be either <code class="prettyprint">Idle</code>, <code class="prettyprint">Building</code>, <code class="prettyprint">LostContact</code>, <code class="prettyprint">Missing</code>, <code class="prettyprint">Cancelled</code>, <code class="prettyprint">Unknown</code></li>
<li><code class="prettyprint">build_state</code> - can be either <code class="prettyprint">Idle</code>, <code class="prettyprint">Building</code>, <code class="prettyprint">Cancelled</code>, <code class="prettyprint">Unknown</code></li>
</ul>

<h2 id="get-settings-view">Get Settings View</h2>

<p>This is an optional message that the plugin may implement, should users want to configure the plugin from the GoCD admin page.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.get-view</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-get-settings-view-object">settings view object</a></p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;some html&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<h2 id="get-plugin-configuration">Get Plugin Configuration</h2>

<p>This is an optional message that the plugin may implement, should users want to configure the plugin from the GoCD admin page. This message allows the server to query a plugin about what properties are supported by this plugin.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.get-configuration</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-plugin-settings-configuration-object">plugin settings configuration object</a>.</p>

<h2 id="validate-plugin-configuration">Validate Plugin Configuration</h2>

<p>If a plugin requires any configuration, this message must be implemented in order to validate the configuration.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.validate-configuration</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example validation request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"plugin-settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The request body will contain a JSON with an attribute <code class="prettyprint">plugin-settings</code>, which contains an object with the configuration keys and values that the plugin is expected to validate.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>The plugin should respond with JSON array response for each configuration key that has a validation error</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server_url"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server URL cannot be localhost"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p>If any of the input keys have a validation error on them, the plugin is expected to return a list of <a href="#the-validation-error-object">validation error objects</a>. If the configuration is valid, the plugin should return an empty JSON array.</p>

<h1 id="requests-to-the-gocd-server">Requests to the GoCD server</h1>

<p>The plugin may make the following requests to the server using <code class="prettyprint">GoApplicationAccessor#submit(GoApiRequest)</code></p>

<ul>
<li><a href="#get-plugin-settings">Get Plugin Settings</a></li>
<li><a href="#get-server-info">Get Server Info</a></li>
<li><a href="#add-server-health-messages">Add Server Health Messages</a></li>
</ul>

<h2 id="get-plugin-settings">Get Plugin Settings</h2>

<div class="highlight"><pre class="highlight java"><code><span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.annotation.Extension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.request.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@Extension</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogNotificationPlugin</span> <span class="kd">implements</span> <span class="nc">GoPlugin</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">getLoggerFor</span><span class="o">(</span><span class="nc">ConsoleLogNotificationPlugin</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initializeGoApplicationAccessor</span><span class="o">(</span><span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">accessor</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">GoPluginIdentifier</span> <span class="nf">pluginIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">GoPluginIdentifier</span><span class="o">(</span><span class="s">"notification"</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"1.0"</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="nc">PluginSettings</span> <span class="nf">getSettings</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Gson</span><span class="o">();</span>
    <span class="c1">// create a request</span>
    <span class="nc">DefaultGoApiRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultGoApiRequest</span><span class="o">(</span>
      <span class="s">"go.processor.plugin-settings.get"</span><span class="o">,</span>
      <span class="s">"1.0"</span><span class="o">,</span>
      <span class="n">pluginIdentifier</span><span class="o">()</span>
    <span class="o">);</span>

    <span class="c1">// set the request body</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"plugin-id"</span><span class="o">,</span> <span class="s">"com.example.rocket.launcher"</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setRequestBody</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">map</span><span class="o">));</span>

    <span class="c1">// submit the request</span>
    <span class="nc">GoApiResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="c1">// check status</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span> <span class="o">{</span>
      <span class="no">LOG</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"The server sent an unexpected status code "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">" with the response body "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// parse the response, using a json parser of your choice</span>
    <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">(),</span> <span class="nc">PluginSettings</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p>This messages allows a plugin to query the server to get the user configured settings for this plugin.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.processor.plugin-settings.get</code></p>

<p class='request-body-heading'>Request version</p>

<p>The request version must be set to <code class="prettyprint">1.0</code>.</p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example request body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"plugin-id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sample-plugin-id"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>Must be a JSON object with a key <code class="prettyprint">plugin-id</code> with the value being the ID of your plugin.</p>

<p class='response-code-heading'>Response code</p>

<p>The server is expected to return status <code class="prettyprint">200</code> if it could process the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://build.go.cd"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"view"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The server will send a map of settings.</p>

<h2 id="get-server-info">Get Server Info</h2>

<p>This messages allows a plugin to query the server to get some metadata about the server.</p>

<p class='available-since'>
  Available since v17.9.0.
</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.processor.server-info.get</code></p>

<p class='request-body-heading'>Request version</p>

<p>The request version must be set to <code class="prettyprint">1.0</code>.</p>

<p class='request-body-heading'>Request body</p>

<p>The plugin should not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The server is expected to return status <code class="prettyprint">200</code> if it could process the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin will provide a <a href="#the-server-info-object">server info</a> object.</p>

<blockquote>
<p>An example response body:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"df0cb9be-2696-4689-8d46-1ef3c4e4447c"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com:8153/go"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"secure_site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com:8154/go"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<h2 id="add-server-health-messages">Add Server Health Messages</h2>
<div class="highlight"><pre class="highlight java"><code><span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.annotation.Extension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.request.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@Extension</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogNotificationPlugin</span> <span class="kd">implements</span> <span class="nc">GoPlugin</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">getLoggerFor</span><span class="o">(</span><span class="nc">ConsoleLogNotificationPlugin</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initializeGoApplicationAccessor</span><span class="o">(</span><span class="nc">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">accessor</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">GoPluginIdentifier</span> <span class="nf">pluginIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">GoPluginIdentifier</span><span class="o">(</span><span class="s">"notification"</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"2.0"</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addErrorsAndWarnings</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Gson</span><span class="o">();</span>
    <span class="c1">// create a request</span>
    <span class="nc">DefaultGoApiRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultGoApiRequest</span><span class="o">(</span>
      <span class="s">"go.processor.server-health.add-messages"</span><span class="o">,</span>
      <span class="s">"1.0"</span><span class="o">,</span>
      <span class="n">pluginIdentifier</span><span class="o">()</span>
    <span class="o">);</span>

    <span class="c1">// set the request body</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">message1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">message1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"warning"</span><span class="o">);</span>
    <span class="n">message1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"A warning message from the plugin."</span><span class="o">);</span>

    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">message2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">message2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"error"</span><span class="o">);</span>
    <span class="n">message2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"An error message from the plugin."</span><span class="o">);</span>

    <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message1</span><span class="o">);</span>
    <span class="n">messages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message2</span><span class="o">);</span>

    <span class="n">request</span><span class="o">.</span><span class="na">setRequestBody</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">messages</span><span class="o">));</span>

    <span class="c1">// submit the request</span>
    <span class="nc">GoApiResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="c1">// check status</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span> <span class="o">{</span>
      <span class="no">LOG</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"The server sent an unexpected status code "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">" with the response body "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>This message allows a plugin to add error and warning messages to be shown in
GoCD. Any previous messages sent by the plugin will be cleared and replaced with
the newly specified messages (or cleared if the body is an empty list).</p>

<p class='available-since'>
  Available since v18.3.0.
</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.processor.server-health.add-messages</code></p>

<p class='request-body-heading'>Request version</p>

<p>The request version must be set to <code class="prettyprint">1.0</code>.</p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example request body:</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warning"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A warning message from the plugin."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An error message from the plugin."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>Must be a JSON array made up of JSON objects as described below:</p>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">type</code></td>
<td><code class="prettyprint">String</code></td>
<td>Should be either <code class="prettyprint">warning</code> or <code class="prettyprint">error</code>, corresponding to the type of message to be shown.</td>
</tr>
<tr>
<td><code class="prettyprint">message</code></td>
<td><code class="prettyprint">String</code></td>
<td>A message to be shown in the &ldquo;Errors and Warnings&rdquo; box.</td>
</tr>
</tbody></table>

<p class='response-code-heading'>Response code</p>

<p>The server is expected to return status <code class="prettyprint">200</code> if it could process the request. It is expected to return status <code class="prettyprint">500</code> if it failed to process the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body for a failure:</p>
</blockquote>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An error occurred ..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>The server will respond with a single JSON object with an error message with the key <code class="prettyprint">message</code>, if it is unable to process the request. If
successful, the response body will be empty.</p>

<h1 id="request-response-json-objects">Request/Response JSON Objects</h1>

<p><a id='the-get-settings-view-object'></a></p>

<h3 id="the-settings-view-object">The Settings View Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the settings view object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div class=</span><span class="se">\"</span><span class="s2">form_item_block</span><span class="se">\"</span><span class="s2">&gt;...&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">template</code></td>
<td>String</td>
<td>A string containing an HTML AngularJS based view.</td>
</tr>
</tbody></table>

<p>This template is an <a href="https://angularjs.org">AngularJS</a> based template.</p>

<p>GoCD uses Angular JS as its template engine for the plugin UI. This allows plugin authors to use a limited set of AngularJS features to specify how the UI of their plugins looks.</p>

<aside class='notice'>
  <strong>Note:</strong> Some plugin endpoints, like the Package Repository plugin, do not use this for their view.
</aside>

<div style='clear: both;'></div>

<h4 id="getting-started-with-angularjs-based-templates">Getting started with AngularJS based templates</h4>

<blockquote>
<p>Given a configuration:</p>
</blockquote>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;key&gt;</span>username<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;value&gt;</span>alice<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>

<blockquote>
<p>This gets converted into the following JSON representation in the browser:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>The AngularJS template is expected to bind to the JSON object shown above:</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>When an Angular template is used in a Go plugin, to define the configuration UI, the configuration key which is stored in the configuration XML is used everywhere and is expected to be consistent. Since Angular works off of JSON, GoCD will make sure that the key in the JSON provided to the Angular template is the same as the key in the configuration XML.</p>

<p>Suppose the key of the configuration property stored in the XML is &ldquo;username&rdquo;, with value, &ldquo;alice&rdquo;, then Go will make sure that the value is available to the template as &ldquo;username&rdquo; when used in an Angular-specific HTML attribute like &ldquo;ng-model&rdquo;.</p>

<p><img src="../images/plugin_angular.png" alt="Plugin Angular Architecture" /></p>

<p>So, the name &ldquo;foobar&rdquo; needs to be the same across the configuration XML, the Angular template as well as in any code that the plugin has.</p>

<div style='clear: both;'></div>

<h4 id="showing-validation-errors-in-the-ui">Showing validation errors in the UI</h4>

<blockquote>
<p>We use some simple string replacement<br/>
to substitute <code class="prettyprint">GOINPUTNAME</code> with a unique identifier<br/>
for your plugin in order to render<br/>
any server side errors</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"form_error"</span> <span class="na">ng-show=</span><span class="s">"GOINPUTNAME[username].$error.server"</span><span class="nt">&gt;</span>
    {{ GOINPUTNAME[username].$error.server}}
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>In case of validation errors returned by <code class="prettyprint">go.plugin-settings.validate-configuration</code>, the error messages needs to be populated on the UI, use the snippet here to show the validation errors.</p>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-plugin-settings-configuration-object">The Plugin Settings Configuration Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the plugin settings configuration object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server URL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">display-name</code></td>
<td>String</td>
<td>The name of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">default-value</code></td>
<td>String</td>
<td>The default value of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">display-order</code></td>
<td>String</td>
<td>A string containing a numerical value.</td>
</tr>
<tr>
<td><code class="prettyprint">required</code></td>
<td>Boolean</td>
<td>If the field is mandatory.</td>
</tr>
<tr>
<td><code class="prettyprint">secure</code></td>
<td>Boolean</td>
<td>If the data in the field should be stored encrypted.</td>
</tr>
</tbody></table>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-validation-error-object">The Validation Error Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the validation error object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email_address"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address is invalid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password must be provided"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">key</code></td>
<td>String</td>
<td>The name of configuration key that has an error.</td>
</tr>
<tr>
<td><code class="prettyprint">message</code></td>
<td>String</td>
<td>The error message associated with that key.</td>
</tr>
</tbody></table>

<p><a id='the-server-info-object'></a></p>

<h3 id="the-server-info-object">The server info object</h3>

<blockquote>
<p>Here&rsquo;s an example of the server info object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"server_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"df0cb9be-2696-4689-8d46-1ef3c4e4447c"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com:8153/go"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"secure_site_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com:8154/go"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">server_id</code></td>
<td>String</td>
<td>This contains a unique identifier for this server.</td>
</tr>
<tr>
<td><code class="prettyprint">site_url</code></td>
<td>String</td>
<td>This contains the site url configured for this server.</td>
</tr>
<tr>
<td><code class="prettyprint">secure_site_url</code></td>
<td>String</td>
<td>This contains the secure site url configured for this server.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
