<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name ="description" content="Extend GoCD's functionality. Implement GoCD plugins for SCMs, tasks, notifications, authentication, package repositories, elastic agents and authorization." />
    <meta name ="keywords" content="gocd plugins, plugins for gocd, extension points, open source gocd, open source continuous delivery" />
    <link href="../images/gocd.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="../images/gocd.png" rel="apple-touch-icon" type="image/png" size="192x192" />
    <title>GoCD SCM Plugin API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sa {
  color: #ae81ff;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />

      <script src="../javascripts/all.js"></script>


      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>
  </head>

  <body class="scm scm_index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="" />
        <div class="lang-selector">
        </div>
      <div class="version-switcher">
        <span class="version-label">Switch version:</span>
        <select class="version"></select>
      </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/gocd/plugin-api.go.cd'>Edit this guide on GitHub</a></li>
            <li><a href='https://api.gocd.org'>GoCD API Documentation</a></li>
            <li><a href='https://docs.gocd.org'>GoCD User Documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="scm-material-plugins">SCM Material Plugins</h1>

<h2 id="extension-information">Extension Information</h2>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th></th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td><strong>Availability</strong></td>
<td>GoCD version 15.1.0 onwards</td>
</tr>
<tr>
<td><strong>Extension Name</strong></td>
<td><code class="prettyprint">scm</code></td>
</tr>
<tr>
<td><strong>Extension API Version</strong></td>
<td><code class="prettyprint">1.0</code></td>
</tr>
</tbody></table>

<p>The SCM extension endpoint allows plugin authors to extend GoCD and integrate it with other SCMs.</p>

<p>GoCD&rsquo;s user documentation has an overview of SCM material plugins. Please see <a href="https://docs.gocd.org/current/extension_points/scm_extension.html">that</a>.</p>

<p><a href="https://github.com/gocd/go-plugins/tree/master/plugins-for-tests/test-scm-plugin">A sample SCM material plugin - JGit</a>                       |</p>

<h1 id="requests-from-the-gocd-server">Requests from the GoCD server</h1>

<p>In order to implement a SCM extension endpoint the following messages must be implemented by the plugin.</p>

<ul>
<li><a href="#scm-configuration">SCM Configuration</a></li>
<li><a href="#scm-view">SCM View</a></li>
<li><a href="#validate-scm-configuration">Validate SCM Configuration</a></li>
<li><a href="#check-scm-connection">Check SCM Connection</a></li>
<li><a href="#latest-revision">Latest SCM Revision</a></li>
<li><a href="#latest-revisions-since">Latest SCM Revisions Since</a></li>
<li><a href="#checkout">Checkout</a></li>
</ul>

<h2 id="scm-configuration">SCM Configuration</h2>

<p>This message is sent by the server, when it wants to know what properties need to be stored in the configuration, for this plugin and this SCM.</p>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">scm-configuration</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide request body.</p>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCM URL"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"part-of-identity"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"part-of-identity"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to return an object containing the configuration property along with <a href="#the-scm-configuration-response-object">scm configuration object</a></p>

<h2 id="scm-view">SCM View</h2>

<p>This message is sent by the server, to get a template to show to the user, to allow information about a SCM to be provided.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">scm-view</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide request body.</p>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"displayValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JGit"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div class=</span><span class="se">\"</span><span class="s2">form_item_block</span><span class="se">\"</span><span class="s2">&gt;&lt;label&gt;Message:&lt;span class=</span><span class="se">\"</span><span class="s2">asterisk</span><span class="se">\"</span><span class="s2">&gt;*&lt;/span&gt;&lt;/label&gt;&lt;input type=</span><span class="se">\"</span><span class="s2">text</span><span class="se">\"</span><span class="s2"> ng-model=</span><span class="se">\"</span><span class="s2">message</span><span class="se">\"</span><span class="s2"> ng-required=</span><span class="se">\"</span><span class="s2">true</span><span class="se">\"</span><span class="s2">&gt;&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to return an object containing the view rendering information <a href="#the-scm-view-response-object">scm view response object</a></p>

<h2 id="validate-scm-configuration">Validate SCM Configuration</h2>

<blockquote>
<p>Example request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scm-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">validate-scm-configuration</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>This contains information about the SCM configuration provided by the user. The keys in the maps correspond to the keys provided by the plugin, as a part of the response to <a href="#scm-configuration">&ldquo;SCM Configuration&rdquo;</a> message.</p>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCM_URL"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCM URL not specified"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RANDOM"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unsupported key(s) found : RANDOM. Allowed key(s) are : SCM_URL, USERNAME, PASSWORD"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to send a response, which contains a list of errors in the SCM configuration, one message for every key in the request. It can also send an empty list, ie [], if the configuration is valid.</p>

<h2 id="check-scm-connection">Check SCM Connection</h2>

<blockquote>
<p>Example request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scm-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">check-scm-connection</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>This contains information about the SCM configuration provided by the user. The keys in the maps correspond to the keys provided by the plugin, as a part of the response to <a href="#scm-configuration">&ldquo;SCM Configuration&rdquo;</a> message.</p>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"Successfully connected to SCM URL provided"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to send a response, which contains a status (&ldquo;success&rdquo; or &ldquo;failure&rdquo;), and a list of error messages. This represents whether a connection was successfully made, to the SCM specified in the request.</p>

<h2 id="latest-revision">Latest Revision</h2>

<blockquote>
<p>Example request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scm-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"flyweight-folder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/go-server/pipelines/flyweight-for-this-material"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">latest-revision</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>This contains information about the SCM configuration provided by the user. The keys in the maps correspond to the keys provided by the plugin, as a part of the response to <a href="#scm-configuration">&ldquo;SCM Configuration&rdquo;</a> message.</p>

<aside class="notice">
  <strong>Note:</strong> It is prudent to validate these details before using them, because direct editing of GoCD&rsquo;s configuration XML file does not cause <a href="#validate-scm-configuration">Validate SCM Configuration</a> to be sent to the plugin. So, the information sent to this call might not be validated by the plugin.
</aside>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revision-1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-14T19:43:37.100Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some-user"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"revisionComment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"comment"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"modifiedFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"fileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file-1"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"added"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"scm-data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to send a response, which contains information about the latest revision it can find of the SCM specified by the information in the request. It can send an empty response ({}) to specify that it could not find a revision.</p>

<p>Almost all the fields expected in this response are explained in this <a href="https://docs.gocd.org/current/extension_points/scm_extension.html#scm-information-display">part of the user documentation</a>. The extra map, named &ldquo;data&rdquo; in the response, can be filled with custom key-value pairs, which will be made available to the agent, as environment variables, when a job contains this plugin as a material.</p>

<h2 id="latest-revisions-since">Latest Revisions Since</h2>

<blockquote>
<p>Example request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scm-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"scm-data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"flyweight-folder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/go-server/pipelines/flyweight-for-this-material"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"previous-revision"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revision-1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-14T19:43:37.100Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">latest-revisions-since</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>This request is very similar to the request of the <a href="#latest-revision">&ldquo;Latest Revision&rdquo; message</a>. This contains information about the SCM configuration provided by the user. The keys in the maps correspond to the keys provided by the plugin, as a part of the response to <a href="#scm-configuration">&ldquo;SCM Configuration&rdquo;</a> messages.</p>

<p>Along with that information, this request contains information about the previous revision of the SCM that GoCD knows about. Compare the &ldquo;previous-revision&rdquo; data of the example request shown below, with the response of the <a href="#latest-revision">&ldquo;Latest Revision&rdquo; message</a> to understand this.</p>

<aside class="notice">
  <strong>Note:</strong> It is prudent to validate these details before using them, because direct editing of GoCD&rsquo;s configuration XML file does not cause <a href="#validate-scm-configuration">Validate SCM Configuration</a> to be sent to the plugin. So, the information sent to this call might not be validated by the plugin.
</aside>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"revisions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revision-2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-14T19:45:37.100Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some-user"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"revisionComment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"comment 2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one-1"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two-2"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"modifiedFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"fileName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file-2"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"modified"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"scm-data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-three"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>Just as with the &ldquo;Latest Revision&rdquo; message, the plugin is expected to send a response, which contains information about the latest revision it can find of the SCM specified by the information in the request. The difference here, is that it needs to find a revisions of the SCM which is greater than the one specified in the request - previous-revision. It can send an empty response ({}) to specify that it could not find revisions (for instance, if there has been no change, and the latest revision is still the one specified in the request).</p>

<p>Almost all the fields expected in this response are explained in this <a href="https://docs.gocd.org/current/extension_points/scm_extension.html#scm-information-display">part of the user documentation</a>. The extra map, named &ldquo;data&rdquo; in the response, can be filled with custom key-value pairs, which will be made available to the agent, as environment variables, when a job contains this plugin as a material.</p>

<h2 id="checkout">Checkout</h2>

<blockquote>
<p>Example request body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scm-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"destination-folder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/go-agent/pipelines/pipeline-name/destination"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revision-1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-14T19:43:37.100Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"dataKeyOne"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-one"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"dataKeyTwo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data-value-two"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">   
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p>The plugin will receive request with following information.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">checkout</code></p>

<p class='request-body-heading'>Request parameters</p>

<p>The server will not provide any parameters.</p>

<p class='request-body-heading'>Request headers</p>

<p>The server will not provide any headers.</p>

<p class='request-body-heading'>Request body</p>

<p>This contains information about the SCM configuration provided by the user. The keys in the maps correspond to the keys provided by the plugin, as a part of the response to <a href="#scm-configuration">&ldquo;SCM Configuration&rdquo;</a> message.</p>

<blockquote>
<p>Example response body</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"Successfully checked out to SCM revision provided"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to send a response, which contains a status (&ldquo;success&rdquo; or &ldquo;failure&rdquo;), and a list of error messages. This represents whether a checkout was successfully made, to the SCM specified in the request.</p>

<h1 id="request-response-json-objects">Request/Response JSON Objects</h1>

<p><a id='the-scm-configuration-response-object'></a></p>

<h3 id="the-scm-configuration-response-object">The SCM Configuration Response Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the scm configuration response object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SCM_URL"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCM URL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"USERNAME"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"part-of-identity"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"PASSWORD"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"part-of-identity"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">default-value</code></td>
<td>String</td>
<td>A value to be used as the default if the user provides no value.</td>
</tr>
<tr>
<td><code class="prettyprint">secure</code></td>
<td>Boolean</td>
<td>If the value should be stored in an encrypted form in the <code class="prettyprint">cruise-config.xml</code> file.</td>
</tr>
<tr>
<td><code class="prettyprint">required</code></td>
<td>Boolean</td>
<td>Whether the field is required.</td>
</tr>
</tbody></table>

<p><a id='the-scm-view-response-object'></a></p>

<h3 id="the-scm-view-response-object">The SCM View Response Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the scm view response object:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"displayValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SCM name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div class=</span><span class="se">\"</span><span class="s2">form_item_block</span><span class="se">\"</span><span class="s2">&gt;...&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">displayValue</code></td>
<td>String</td>
<td>The name of the scm that should be rendered in the view.</td>
</tr>
<tr>
<td><code class="prettyprint">template</code></td>
<td>String</td>
<td>A string containing an HTML AngularJS based view.</td>
</tr>
</tbody></table>

<p>GoCD uses Angular JS as its template engine for the plugin UI. This allows plugin authors to use a limited set of AngularJS features to specify how the UI of their plugins looks.</p>

<aside class='notice'>
  <strong>Note:</strong> Some plugin endpoints, like the Package Repository plugin, do not use this for their view.
</aside>

<div style='clear: both;'></div>

<h4 id="getting-started-with-angularjs-based-templates">Getting started with AngularJS based templates</h4>

<blockquote>
<p>Given a configuration:</p>
</blockquote>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;key&gt;</span>username<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;value&gt;</span>alice<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>

<blockquote>
<p>This gets converted into the following JSON representation in the browser:</p>
</blockquote>

<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<blockquote>
<p>The AngularJS template is expected to bind to the JSON object shown above:</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>When an Angular template is used in a Go plugin, to define the configuration UI, the configuration key which is stored in the configuration XML is used everywhere and is expected to be consistent. Since Angular works off of JSON, GoCD will make sure that the key in the JSON provided to the Angular template is the same as the key in the configuration XML.</p>

<p>Suppose the key of the configuration property stored in the XML is &ldquo;username&rdquo;, with value, &ldquo;alice&rdquo;, then Go will make sure that the value is available to the template as &ldquo;username&rdquo; when used in an Angular-specific HTML attribute like &ldquo;ng-model&rdquo;.</p>

<p><img src="../images/plugin_angular.png" alt="Plugin Angular Architecture" /></p>

<p>So, the name &ldquo;foobar&rdquo; needs to be the same across the configuration XML, the Angular template as well as in any code that the plugin has.</p>

<div style='clear: both;'></div>

<h4 id="showing-validation-errors-in-the-ui">Showing validation errors in the UI</h4>

<blockquote>
<p>We use some simple string replacement<br/>
to substitute <code class="prettyprint">GOINPUTNAME</code> with a unique identifier<br/>
for your plugin in order to render<br/>
any server side errors</p>
</blockquote>

<div class="highlight"><pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"form_error"</span> <span class="na">ng-show=</span><span class="s">"GOINPUTNAME[username].$error.server"</span><span class="nt">&gt;</span>
    {{ GOINPUTNAME[username].$error.server}}
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>In case of validation errors returned by <code class="prettyprint">go.plugin-settings.validate-configuration</code>, the error messages needs to be populated on the UI, use the snippet here to show the validation errors.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
